{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/lib/api.ts"],"sourcesContent":["export function getApiBaseUrl() {\n  return (\n    process.env.NEXT_PUBLIC_API_URL || \"https://game-api.dev.datefrueet.ru\"\n  );\n}\n\nexport async function apiFetch<T>(\n  path: string,\n  init?: RequestInit\n): Promise<T> {\n  const url = `${getApiBaseUrl()}${path}`;\n  const res = await fetch(url, {\n    ...init,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(init?.headers || {}),\n    },\n    cache: \"no-store\",\n  });\n\n  if (!res.ok) {\n    let message = `HTTP ${res.status}`;\n    try {\n      const data = await res.json();\n      if (typeof data?.message === \"string\") message = data.message;\n    } catch {\n      // ignore\n    }\n    throw new Error(message);\n  }\n\n  return (await res.json()) as T;\n}\n"],"names":[],"mappings":";;;;;;AAAO,SAAS;IACd,OACE,6DAAmC;AAEvC;AAEO,eAAe,SACpB,IAAY,EACZ,IAAkB;IAElB,MAAM,MAAM,GAAG,kBAAkB,MAAM;IACvC,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,GAAG,IAAI;QACP,SAAS;YACP,gBAAgB;YAChB,GAAI,MAAM,WAAW,CAAC,CAAC;QACzB;QACA,OAAO;IACT;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,IAAI,UAAU,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;QAClC,IAAI;YACF,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,IAAI,OAAO,MAAM,YAAY,UAAU,UAAU,KAAK,OAAO;QAC/D,EAAE,OAAM;QACN,SAAS;QACX;QACA,MAAM,IAAI,MAAM;IAClB;IAEA,OAAQ,MAAM,IAAI,IAAI;AACxB"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/stores/authStore.ts"],"sourcesContent":["\"use client\";\n\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport { apiFetch } from \"@/lib/api\";\n\ntype LoginResult = { ok: true } | { ok: false; message: string };\n\nexport class AuthStore {\n  token: string | null = null;\n  loading = false;\n  error: string | null = null;\n\n  constructor() {\n    makeAutoObservable(this);\n  }\n\n  get isAuthed() {\n    return Boolean(this.token);\n  }\n\n  hydrate() {\n    if (typeof window === \"undefined\") return;\n    const token = window.localStorage.getItem(\"web_token\");\n    runInAction(() => {\n      this.token = token || null;\n    });\n  }\n\n  logout() {\n    if (typeof window !== \"undefined\") {\n      window.localStorage.removeItem(\"web_token\");\n    }\n    this.token = null;\n  }\n\n  async login(password: string): Promise<LoginResult> {\n    this.loading = true;\n    this.error = null;\n    try {\n      const res = await apiFetch<{ token: string }>(\"/api/web/auth/login\", {\n        method: \"POST\",\n        body: JSON.stringify({ password }),\n      });\n\n      if (!res.token) {\n        return { ok: false, message: \"Не удалось войти\" };\n      }\n\n      runInAction(() => {\n        this.token = res.token;\n      });\n\n      if (typeof window !== \"undefined\") {\n        window.localStorage.setItem(\"web_token\", res.token);\n      }\n\n      return { ok: true };\n    } catch (e: unknown) {\n      const message =\n        e instanceof Error\n          ? e.message\n          : typeof e === \"string\"\n          ? e\n          : \"Ошибка авторизации\";\n      runInAction(() => {\n        this.error = message;\n      });\n      return { ok: false, message };\n    } finally {\n      runInAction(() => {\n        this.loading = false;\n      });\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAOO,MAAM;IACX,QAAuB,KAAK;IAC5B,UAAU,MAAM;IAChB,QAAuB,KAAK;IAE5B,aAAc;QACZ,IAAA,iKAAkB,EAAC,IAAI;IACzB;IAEA,IAAI,WAAW;QACb,OAAO,QAAQ,IAAI,CAAC,KAAK;IAC3B;IAEA,UAAU;QACR,wCAAmC;;;QACnC,MAAM;IAIR;IAEA,SAAS;QACP;;QAGA,IAAI,CAAC,KAAK,GAAG;IACf;IAEA,MAAM,MAAM,QAAgB,EAAwB;QAClD,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,KAAK,GAAG;QACb,IAAI;YACF,MAAM,MAAM,MAAM,IAAA,6HAAQ,EAAoB,uBAAuB;gBACnE,QAAQ;gBACR,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAS;YAClC;YAEA,IAAI,CAAC,IAAI,KAAK,EAAE;gBACd,OAAO;oBAAE,IAAI;oBAAO,SAAS;gBAAmB;YAClD;YAEA,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK;YACxB;YAEA;;YAIA,OAAO;gBAAE,IAAI;YAAK;QACpB,EAAE,OAAO,GAAY;YACnB,MAAM,UACJ,aAAa,QACT,EAAE,OAAO,GACT,OAAO,MAAM,WACb,IACA;YACN,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GAAG;YACf;YACA,OAAO;gBAAE,IAAI;gBAAO;YAAQ;QAC9B,SAAU;YACR,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,OAAO,GAAG;YACjB;QACF;IACF;AACF"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/stores/cardsStore.ts"],"sourcesContent":["\"use client\";\n\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport { apiFetch } from \"@/lib/api\";\nimport type { AuthStore } from \"./authStore\";\n\nexport type WebCard = {\n  id: number;\n  order: number;\n  text: string;\n  imageUrl: string | null;\n  enabled: boolean;\n  state: 0 | 1 | 2;\n};\n\nexport class CardsStore {\n  private auth: AuthStore;\n\n  pageTitle = \"Коллекция карточек\";\n  pageDescription = \"Для активации необходимо нажать на карточку\";\n  items: WebCard[] = [];\n  loading = false;\n  error: string | null = null;\n\n  constructor(auth: AuthStore) {\n    makeAutoObservable(this);\n    this.auth = auth;\n  }\n\n  async load() {\n    if (!this.auth.token) return;\n    this.loading = true;\n    this.error = null;\n    try {\n      const data = await apiFetch<{\n        title: string;\n        description: string;\n        cards: WebCard[];\n      }>(\"/api/web/home\", {\n        headers: { Authorization: `Bearer ${this.auth.token}` },\n      });\n      runInAction(() => {\n        this.pageTitle = data?.title || this.pageTitle;\n        this.pageDescription = data?.description || this.pageDescription;\n        this.items = (data?.cards || [])\n          .slice()\n          .sort((a, b) => a.order - b.order);\n      });\n    } catch (e: unknown) {\n      runInAction(() => {\n        this.error =\n          e instanceof Error ? e.message : \"Ошибка загрузки карточек\";\n      });\n    } finally {\n      runInAction(() => {\n        this.loading = false;\n      });\n    }\n  }\n\n  async setState(cardId: number, state: 0 | 1 | 2) {\n    if (!this.auth.token) return;\n    // optimistic\n    const prev = this.items.find((x) => x.id === cardId)?.state;\n    runInAction(() => {\n      this.items = this.items.map((x) =>\n        x.id === cardId ? { ...x, state } : x\n      );\n    });\n\n    try {\n      await apiFetch<{ success: true }>(`/api/web/cards/${cardId}/state`, {\n        method: \"PUT\",\n        headers: { Authorization: `Bearer ${this.auth.token}` },\n        body: JSON.stringify({ state }),\n      });\n    } catch (e: unknown) {\n      // rollback\n      runInAction(() => {\n        this.items = this.items.map((x) =>\n          x.id === cardId ? { ...x, state: (prev ?? 0) as 0 | 1 | 2 } : x\n        );\n        this.error = e instanceof Error ? e.message : \"Ошибка сохранения\";\n      });\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAeO,MAAM;IACH,KAAgB;IAExB,YAAY,qBAAqB;IACjC,kBAAkB,8CAA8C;IAChE,QAAmB,EAAE,CAAC;IACtB,UAAU,MAAM;IAChB,QAAuB,KAAK;IAE5B,YAAY,IAAe,CAAE;QAC3B,IAAA,iKAAkB,EAAC,IAAI;QACvB,IAAI,CAAC,IAAI,GAAG;IACd;IAEA,MAAM,OAAO;QACX,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;QACtB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,KAAK,GAAG;QACb,IAAI;YACF,MAAM,OAAO,MAAM,IAAA,6HAAQ,EAIxB,iBAAiB;gBAClB,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBAAC;YACxD;YACA,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,SAAS,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS;gBAC9C,IAAI,CAAC,eAAe,GAAG,MAAM,eAAe,IAAI,CAAC,eAAe;gBAChE,IAAI,CAAC,KAAK,GAAG,CAAC,MAAM,SAAS,EAAE,EAC5B,KAAK,GACL,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;YACrC;QACF,EAAE,OAAO,GAAY;YACnB,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GACR,aAAa,QAAQ,EAAE,OAAO,GAAG;YACrC;QACF,SAAU;YACR,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,OAAO,GAAG;YACjB;QACF;IACF;IAEA,MAAM,SAAS,MAAc,EAAE,KAAgB,EAAE;QAC/C,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;QACtB,aAAa;QACb,MAAM,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,SAAS;QACtD,IAAA,0JAAW,EAAC;YACV,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAC3B,EAAE,EAAE,KAAK,SAAS;oBAAE,GAAG,CAAC;oBAAE;gBAAM,IAAI;QAExC;QAEA,IAAI;YACF,MAAM,IAAA,6HAAQ,EAAoB,CAAC,eAAe,EAAE,OAAO,MAAM,CAAC,EAAE;gBAClE,QAAQ;gBACR,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBAAC;gBACtD,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAM;YAC/B;QACF,EAAE,OAAO,GAAY;YACnB,WAAW;YACX,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAC3B,EAAE,EAAE,KAAK,SAAS;wBAAE,GAAG,CAAC;wBAAE,OAAQ,QAAQ;oBAAgB,IAAI;gBAEhE,IAAI,CAAC,KAAK,GAAG,aAAa,QAAQ,EAAE,OAAO,GAAG;YAChD;QACF;IACF;AACF"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/stores/historyStore.ts"],"sourcesContent":["\"use client\";\n\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport type { AuthStore } from \"./authStore\";\nimport { apiFetch } from \"@/lib/api\";\n\nexport type HistoryItem = {\n  pointIndex: number;\n  day: number;\n  message: string | null;\n  imageUrl: string | null;\n  question: string | null;\n  answer: string | null;\n  hasAnsweredQuestion: boolean;\n};\n\nexport class HistoryStore {\n  private auth: AuthStore;\n\n  items: HistoryItem[] = [];\n  loading = false;\n  error: string | null = null;\n\n  constructor(auth: AuthStore) {\n    makeAutoObservable(this);\n    this.auth = auth;\n  }\n\n  async load() {\n    if (!this.auth.token) return;\n    this.loading = true;\n    this.error = null;\n    try {\n      // Историю мы берём из старого эндпоинта игры (прошлая версия)\n      const data = await apiFetch<HistoryItem[]>(\"/api/game/history\", {\n        headers: { Authorization: `Bearer ${this.auth.token}` },\n      });\n      runInAction(() => {\n        this.items = data || [];\n      });\n    } catch (e: unknown) {\n      runInAction(() => {\n        this.error = e instanceof Error ? e.message : \"Ошибка загрузки истории\";\n      });\n    } finally {\n      runInAction(() => {\n        this.loading = false;\n      });\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AAJA;;;AAgBO,MAAM;IACH,KAAgB;IAExB,QAAuB,EAAE,CAAC;IAC1B,UAAU,MAAM;IAChB,QAAuB,KAAK;IAE5B,YAAY,IAAe,CAAE;QAC3B,IAAA,iKAAkB,EAAC,IAAI;QACvB,IAAI,CAAC,IAAI,GAAG;IACd;IAEA,MAAM,OAAO;QACX,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;QACtB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,KAAK,GAAG;QACb,IAAI;YACF,8DAA8D;YAC9D,MAAM,OAAO,MAAM,IAAA,6HAAQ,EAAgB,qBAAqB;gBAC9D,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBAAC;YACxD;YACA,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GAAG,QAAQ,EAAE;YACzB;QACF,EAAE,OAAO,GAAY;YACnB,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,KAAK,GAAG,aAAa,QAAQ,EAAE,OAAO,GAAG;YAChD;QACF,SAAU;YACR,IAAA,0JAAW,EAAC;gBACV,IAAI,CAAC,OAAO,GAAG;YACjB;QACF;IACF;AACF"}},
    {"offset": {"line": 247, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/components/Pwa/ServiceWorkerRegister.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\n\nexport function ServiceWorkerRegister() {\n  useEffect(() => {\n    if (process.env.NODE_ENV !== \"production\") return;\n    if (!(\"serviceWorker\" in navigator)) return;\n\n    const register = async () => {\n      try {\n        await navigator.serviceWorker.register(\"/sw.js\", { scope: \"/\" });\n      } catch {\n        // Если SW не зарегистрировался, просто молча живём дальше\n      }\n    };\n\n    void register();\n  }, []);\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAIO,SAAS;IACd,IAAA,kNAAS,EAAC;QACR,wCAA2C;;;QAG3C,MAAM;IASR,GAAG,EAAE;IAEL,OAAO;AACT"}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///Users/m/Documents/game%2B/web/src/app/providers.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useEffect, useMemo } from \"react\";\nimport { AuthStore } from \"@/stores/authStore\";\nimport { CardsStore } from \"@/stores/cardsStore\";\nimport { HistoryStore } from \"@/stores/historyStore\";\nimport { ServiceWorkerRegister } from \"@/components/Pwa/ServiceWorkerRegister\";\n\ntype Stores = {\n  auth: AuthStore;\n  cards: CardsStore;\n  history: HistoryStore;\n};\n\nconst StoresContext = createContext<Stores | null>(null);\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const stores = useMemo<Stores>(() => {\n    const auth = new AuthStore();\n    return {\n      auth,\n      cards: new CardsStore(auth),\n      history: new HistoryStore(auth),\n    };\n  }, []);\n\n  // Гидрация токена из localStorage\n  useEffect(() => {\n    stores.auth.hydrate();\n  }, [stores.auth]);\n\n  return (\n    <StoresContext.Provider value={stores}>\n      <ServiceWorkerRegister />\n      {children}\n    </StoresContext.Provider>\n  );\n}\n\nexport function useStores(): Stores {\n  const ctx = useContext(StoresContext);\n  if (!ctx) {\n    throw new Error(\"useStores must be used within Providers\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAcA,MAAM,8BAAgB,IAAA,sNAAa,EAAgB;AAE5C,SAAS,UAAU,EAAE,QAAQ,EAAiC;IACnE,MAAM,SAAS,IAAA,gNAAO,EAAS;QAC7B,MAAM,OAAO,IAAI,uIAAS;QAC1B,OAAO;YACL;YACA,OAAO,IAAI,yIAAU,CAAC;YACtB,SAAS,IAAI,6IAAY,CAAC;QAC5B;IACF,GAAG,EAAE;IAEL,kCAAkC;IAClC,IAAA,kNAAS,EAAC;QACR,OAAO,IAAI,CAAC,OAAO;IACrB,GAAG;QAAC,OAAO,IAAI;KAAC;IAEhB,qBACE,8OAAC,cAAc,QAAQ;QAAC,OAAO;;0BAC7B,8OAAC,2KAAqB;;;;;YACrB;;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,mNAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}